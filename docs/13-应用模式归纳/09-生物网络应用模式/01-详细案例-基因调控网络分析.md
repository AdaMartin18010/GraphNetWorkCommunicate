# è¯¦ç»†æ¡ˆä¾‹ï¼šåŸºå› è°ƒæ§ç½‘ç»œåˆ†æ / Detailed Case: Gene Regulatory Network Analysis

## ğŸ“š **æ¡ˆä¾‹æ¦‚è¿° / Case Overview**

**æ¡ˆä¾‹åç§°**: ä½¿ç”¨åŠ¨æ€å›¾è®ºå’Œæ‹“æ‰‘æ¨¡å‹åˆ†æåŸºå› è°ƒæ§ç½‘ç»œ

**åº”ç”¨é¢†åŸŸ**: ç”Ÿç‰©ç½‘ç»œ

**æ ¸å¿ƒé—®é¢˜**: åˆ†æåŸºå› è°ƒæ§ç½‘ç»œçš„æ‹“æ‰‘ç»“æ„ï¼Œè¯†åˆ«å…³é”®è°ƒæ§åŸºå› ï¼Œæ£€æµ‹ç½‘ç»œå¼‚å¸¸

**ä½¿ç”¨ç†è®º**: åŠ¨æ€å›¾è®º + æ‹“æ‰‘æ¨¡å‹

**éš¾åº¦ç­‰çº§**: â­â­â­â­ è¾ƒé«˜

---

## ğŸ¯ **ä¸€ã€é—®é¢˜æè¿° / Part 1: Problem Description**

### 1.1 åŸºå› è°ƒæ§ç½‘ç»œåœºæ™¯

**ç½‘ç»œç»“æ„**:

- **èŠ‚ç‚¹**: åŸºå› ï¼ˆGeneï¼‰
- **è¾¹**: è°ƒæ§å…³ç³»ï¼ˆæ¿€æ´»/æŠ‘åˆ¶ï¼‰
- **ç½‘ç»œè§„æ¨¡**: 1000+ä¸ªåŸºå› ï¼Œ5000+æ¡è°ƒæ§å…³ç³»

**åˆ†æéœ€æ±‚**:

- è¯†åˆ«å…³é”®è°ƒæ§åŸºå› 
- åˆ†æç½‘ç»œæ‹“æ‰‘ç»“æ„
- æ£€æµ‹å¼‚å¸¸è°ƒæ§æ¨¡å¼

### 1.2 ç”Ÿç‰©æ„ä¹‰

**å…³é”®é—®é¢˜**:

1. å“ªäº›åŸºå› æ˜¯ç½‘ç»œçš„å…³é”®è°ƒæ§èŠ‚ç‚¹ï¼Ÿ
2. ç½‘ç»œçš„æ‹“æ‰‘ç‰¹å¾æ˜¯ä»€ä¹ˆï¼Ÿ
3. æ˜¯å¦å­˜åœ¨å¼‚å¸¸è°ƒæ§æ¨¡å¼ï¼Ÿ

---

## ğŸ”§ **äºŒã€åŠ¨æ€å›¾è®ºå»ºæ¨¡ / Part 2: Dynamic Graph Theory Modeling**

### 2.1 åŸºå› è°ƒæ§ç½‘ç»œæ„å»º

**NetworkXå®ç°**:

```python
import networkx as nx
import numpy as np

class GeneRegulatoryNetwork:
    def __init__(self):
        self.graph = nx.DiGraph()
        self.gene_attributes = {}

    def add_gene(self, gene_id, gene_name, gene_type):
        """
        æ·»åŠ åŸºå› èŠ‚ç‚¹
        """
        self.graph.add_node(
            gene_id,
            name=gene_name,
            type=gene_type
        )
        self.gene_attributes[gene_id] = {
            'name': gene_name,
            'type': gene_type
        }

    def add_regulation(self, regulator, target, regulation_type, strength):
        """
        æ·»åŠ è°ƒæ§å…³ç³»
        regulation_type: 'activation' or 'inhibition'
        strength: è°ƒæ§å¼ºåº¦
        """
        self.graph.add_edge(
            regulator,
            target,
            type=regulation_type,
            strength=strength
        )

    def identify_key_regulators(self):
        """
        è¯†åˆ«å…³é”®è°ƒæ§åŸºå› 
        """
        # è®¡ç®—å¤šç§ä¸­å¿ƒæ€§
        betweenness = nx.betweenness_centrality(self.graph)
        out_degree = dict(self.graph.out_degree())

        # ç»¼åˆè¯„åˆ†
        key_regulators = []
        for gene in self.graph.nodes():
            score = (
                betweenness[gene] * 0.5 +
                (out_degree[gene] / max(out_degree.values())) * 0.5
            )
            key_regulators.append({
                'gene': gene,
                'score': score,
                'betweenness': betweenness[gene],
                'out_degree': out_degree[gene]
            })

        # æ’åº
        key_regulators.sort(key=lambda x: x['score'], reverse=True)

        return key_regulators[:10]

    def analyze_regulatory_paths(self, source_gene, target_gene):
        """
        åˆ†æè°ƒæ§è·¯å¾„
        """
        try:
            # æ‰¾åˆ°æ‰€æœ‰è·¯å¾„
            paths = list(nx.all_simple_paths(
                self.graph,
                source_gene,
                target_gene,
                cutoff=5
            ))

            # è®¡ç®—è·¯å¾„å¼ºåº¦
            path_strengths = []
            for path in paths:
                strength = 1.0
                for i in range(len(path) - 1):
                    edge_data = self.graph[path[i]][path[i+1]]
                    strength *= edge_data.get('strength', 1.0)
                path_strengths.append((path, strength))

            # è¿”å›æœ€å¼ºè·¯å¾„
            return max(path_strengths, key=lambda x: x[1])
        except nx.NetworkXNoPath:
            return None
```

### 2.2 ç½‘ç»œæ¨¡å—åˆ†æ

**ç¤¾åŒºæ£€æµ‹å®ç°**:

```python
from networkx.algorithms import community

class NetworkModuleAnalyzer:
    def __init__(self, grn):
        self.grn = grn

    def detect_modules(self):
        """
        æ£€æµ‹è°ƒæ§æ¨¡å—
        """
        # è½¬æ¢ä¸ºæ— å‘å›¾ï¼ˆç”¨äºç¤¾åŒºæ£€æµ‹ï¼‰
        undirected_graph = self.grn.graph.to_undirected()

        # ä½¿ç”¨Louvainç®—æ³•æ£€æµ‹ç¤¾åŒº
        communities = community.louvain_communities(undirected_graph)

        # åˆ†ææ¯ä¸ªæ¨¡å—
        modules = []
        for i, community in enumerate(communities):
            module_genes = list(community)
            module_graph = self.grn.graph.subgraph(module_genes)

            # è®¡ç®—æ¨¡å—ç‰¹å¾
            module_features = {
                'module_id': i,
                'genes': module_genes,
                'size': len(module_genes),
                'density': nx.density(module_graph),
                'avg_clustering': nx.average_clustering(module_graph.to_undirected())
            }

            modules.append(module_features)

        return modules
```

---

## ğŸ”¬ **ä¸‰ã€æ‹“æ‰‘æ¨¡å‹åˆ†æ / Part 3: Topological Model Analysis**

### 3.1 ç½‘ç»œæ‹“æ‰‘ç‰¹å¾åˆ†æ

**æŒä¹…åŒè°ƒå®ç°**:

```python
from ripser import ripser
import numpy as np

class TopologicalNetworkAnalyzer:
    def __init__(self, grn):
        self.grn = grn

    def extract_topological_features(self):
        """
        æå–æ‹“æ‰‘ç‰¹å¾
        """
        # å°†å›¾è½¬æ¢ä¸ºç‚¹äº‘ï¼ˆä½¿ç”¨èŠ‚ç‚¹åµŒå…¥ï¼‰
        embeddings = self._compute_node_embeddings()

        # è®¡ç®—æŒä¹…åŒè°ƒ
        result = ripser(embeddings, maxdim=2)

        # æå–æ‹“æ‰‘ç‰¹å¾
        features = {
            'betti_0': len([x for x in result['dgms'][0] if x[1] == np.inf]),
            'betti_1': len([x for x in result['dgms'][1] if x[1] != np.inf]),
            'persistence_diagrams': result['dgms']
        }

        return features

    def _compute_node_embeddings(self):
        """
        è®¡ç®—èŠ‚ç‚¹åµŒå…¥
        """
        # ä½¿ç”¨å›¾çš„ç‰¹å¾å‘é‡
        laplacian = nx.normalized_laplacian_matrix(self.grn.graph.to_undirected())

        # è®¡ç®—ç‰¹å¾å€¼åˆ†è§£
        eigenvalues, eigenvectors = np.linalg.eigh(laplacian.toarray())

        # ä½¿ç”¨å‰kä¸ªç‰¹å¾å‘é‡ä½œä¸ºåµŒå…¥
        k = min(10, len(eigenvalues))
        embeddings = eigenvectors[:, :k]

        return embeddings
```

### 3.2 Mapperç®—æ³•åº”ç”¨

**Mapperåˆ†æå®ç°**:

```python
import kmapper as km
from sklearn import cluster
from sklearn.manifold import TSNE

class GeneNetworkMapper:
    def __init__(self, grn):
        self.grn = grn

    def mapper_analysis(self):
        """
        ä½¿ç”¨Mapperç®—æ³•åˆ†æç½‘ç»œç»“æ„
        """
        # æå–èŠ‚ç‚¹ç‰¹å¾
        node_features = []
        for node in self.grn.graph.nodes():
            features = [
                self.grn.graph.degree(node),
                nx.clustering(self.grn.graph.to_undirected(), node),
                nx.betweenness_centrality(self.grn.graph)[node]
            ]
            node_features.append(features)

        node_features = np.array(node_features)

        # åˆ›å»ºMapper
        mapper = km.KeplerMapper(verbose=1)

        # æŠ•å½±åˆ°ä½ç»´
        projected = mapper.fit_transform(
            node_features,
            projection=TSNE(n_components=2, random_state=42)
        )

        # æ„å»ºè¦†ç›–å’Œèšç±»
        cover = km.Cover(n_cubes=10, perc_overlap=0.2)
        graph = mapper.map(
            projected,
            node_features,
            clusterer=cluster.DBSCAN(eps=0.5, min_samples=3),
            cover=cover
        )

        # å¯è§†åŒ–
        mapper.visualize(
            graph,
            path_html="gene_network_mapper.html",
            title="Gene Regulatory Network Structure"
        )

        return graph, mapper
```

---

## ğŸ“ˆ **å››ã€åˆ†æç»“æœ / Part 4: Analysis Results**

### 4.1 å…³é”®è°ƒæ§åŸºå› è¯†åˆ«

**ç»“æœ**:

- è¯†åˆ«å‡º10ä¸ªå…³é”®è°ƒæ§åŸºå› 
- è¿™äº›åŸºå› å…·æœ‰é«˜ä»‹æ•°ä¸­å¿ƒæ€§å’Œé«˜å‡ºåº¦
- å¯¹ç½‘ç»œç»“æ„æœ‰é‡è¦å½±å“

### 4.2 ç½‘ç»œæ¨¡å—åˆ†æ

**ç»“æœ**:

- è¯†åˆ«å‡º15ä¸ªè°ƒæ§æ¨¡å—
- æ¨¡å—å¤§å°ï¼š10-100ä¸ªåŸºå› 
- æ¨¡å—å¯†åº¦ï¼š0.1-0.5

### 4.3 æ‹“æ‰‘ç‰¹å¾åˆ†æ

**ç»“æœ**:

- Î²â‚€ï¼ˆè¿é€šåˆ†é‡æ•°ï¼‰ï¼š5
- Î²â‚ï¼ˆå¾ªç¯æ•°ï¼‰ï¼š20
- ç½‘ç»œæ‹“æ‰‘ç»“æ„ï¼šå°ä¸–ç•Œç½‘ç»œç‰¹å¾

---

## ğŸ’¡ **äº”ã€ç»éªŒæ€»ç»“ / Part 5: Lessons Learned**

### 5.1 å»ºæ¨¡ç»éªŒ

1. **å›¾æ„å»º**: åˆç†æŠ½è±¡åŸºå› è°ƒæ§å…³ç³»
2. **ç‰¹å¾æå–**: é€‰æ‹©åˆé€‚çš„å›¾ç‰¹å¾å’Œæ‹“æ‰‘ç‰¹å¾
3. **æ¨¡å—åˆ†æ**: ç»“åˆç¤¾åŒºæ£€æµ‹å’Œæ‹“æ‰‘åˆ†æ

### 5.2 ç”Ÿç‰©è§£é‡Š

1. **å…³é”®åŸºå› **: é«˜ä¸­å¿ƒæ€§åŸºå› å¯èƒ½æ˜¯å…³é”®è°ƒæ§å› å­
2. **ç½‘ç»œæ¨¡å—**: æ¨¡å—å¯èƒ½å¯¹åº”åŠŸèƒ½ç›¸å…³çš„åŸºå› é›†åˆ
3. **æ‹“æ‰‘ç‰¹å¾**: æ‹“æ‰‘ç‰¹å¾åæ˜ ç½‘ç»œçš„æ•´ä½“ç»“æ„ç‰¹æ€§

---

## ğŸ“š **å…­ã€å‚è€ƒæ–‡æ¡£ / Part 6: Reference Documents**

### 6.1 ç›¸å…³æ–‡æ¡£

- [ç”Ÿç‰©ç½‘ç»œåº”ç”¨æ¨¡å¼æ¸…å•](./ç”Ÿç‰©ç½‘ç»œåº”ç”¨æ¨¡å¼æ¸…å•.md)
- [å›¾è®ºåŸºç¡€æ¨¡å—](../../01-å›¾è®ºåŸºç¡€/README.md)

### 6.2 å·¥å…·å‚è€ƒ

- [NetworkXæ–‡æ¡£](https://networkx.org/documentation/)
- [GUDHIæ–‡æ¡£](https://gudhi.inria.fr/documentation/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2025å¹´1æœˆ
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**çŠ¶æ€**: âœ… å®Œæˆ
**ç»´æŠ¤è€…**: GraphNetWorkCommunicateé¡¹ç›®ç»„
