# è½¬æ¢ç´¢å¼•æœç´¢ä¸“é¢˜ / Transformation Indexing and Search Topic

## ğŸ“š **æ¦‚è¿° / Overview**

æœ¬æ–‡æ¡£ä¸“é—¨ä»‹ç»å½¢å¼åŒ–æ¨¡å‹è½¬æ¢çš„ç´¢å¼•ä¸æœç´¢æœºåˆ¶ï¼ŒåŒ…å«**å®Œæ•´çš„ä»£ç å®ç°**å’Œ**ä¸¥æ ¼çš„å½¢å¼åŒ–è¯æ˜**ã€‚

**æ–‡æ¡£ç‰¹ç‚¹**ï¼š

- âœ… **å®Œæ•´ä»£ç å®ç°**ï¼šç´¢å¼•æ„å»ºã€æœç´¢ç®—æ³•ã€æŸ¥è¯¢ä¼˜åŒ–ã€å…¨æ–‡æœç´¢ç®—æ³•
- âœ… **ä¸¥æ ¼å½¢å¼åŒ–è¯æ˜**ï¼šç´¢å¼•æ­£ç¡®æ€§ã€æœç´¢å®Œæ•´æ€§ã€æŸ¥è¯¢ä¼˜åŒ–æœ‰æ•ˆæ€§
- âœ… **å…¨é¢ç´¢å¼•æœç´¢**ï¼šç´¢å¼•æ„å»ºã€æœç´¢ç®—æ³•ã€æŸ¥è¯¢ä¼˜åŒ–ã€å…¨æ–‡æœç´¢ã€æ¨¡ç³Šæœç´¢
- âœ… **å®ç”¨å·¥å…·**ï¼šç´¢å¼•æ„å»ºå™¨ã€æœç´¢å¼•æ“ã€æŸ¥è¯¢ä¼˜åŒ–å™¨ã€å…¨æ–‡æœç´¢å™¨

**è´¨é‡ç­‰çº§**: â­â­â­â­â­ äº”æ˜Ÿçº§
**åˆ›å»ºæ—¶é—´**: 2025å¹´1æœˆ
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ

---

## ğŸ“‘ **ç›®å½• / Table of Contents**

- [1. ç†è®ºåŸºç¡€ / Theoretical Foundation](#1-ç†è®ºåŸºç¡€--theoretical-foundation)
- [2. ç´¢å¼•æ„å»º / Index Construction](#2-ç´¢å¼•æ„å»º--index-construction)
- [3. æœç´¢ç®—æ³• / Search Algorithms](#3-æœç´¢ç®—æ³•--search-algorithms)
- [4. æŸ¥è¯¢ä¼˜åŒ– / Query Optimization](#4-æŸ¥è¯¢ä¼˜åŒ–--query-optimization)
- [5. å½¢å¼åŒ–è¯æ˜ / Formal Proofs](#5-å½¢å¼åŒ–è¯æ˜--formal-proofs)
- [6. ä»£ç å®ç° / Code Implementation](#6-ä»£ç å®ç°--code-implementation)
- [7. åº”ç”¨æ¡ˆä¾‹ / Application Cases](#7-åº”ç”¨æ¡ˆä¾‹--application-cases)

---

## 1. ç†è®ºåŸºç¡€ / Theoretical Foundation

### 1.1 ç´¢å¼•å®šä¹‰ / Index Definition

**å®šä¹‰ 1.1** (ç´¢å¼• / Index)

ç´¢å¼• $Index(Documents)$ ä¸ºæ–‡æ¡£é›†åˆæ„å»ºç´¢å¼•ï¼š

$$Index(Documents) = (InvertedIndex, ForwardIndex, MetadataIndex)$$

å…¶ä¸­ï¼š
- $InvertedIndex$ï¼šå€’æ’ç´¢å¼•
- $ForwardIndex$ï¼šæ­£å‘ç´¢å¼•
- $MetadataIndex$ï¼šå…ƒæ•°æ®ç´¢å¼•

### 1.2 ç´¢å¼•æ­£ç¡®æ€§å®šä¹‰ / Index Correctness Definition

**å®šä¹‰ 1.2** (ç´¢å¼•æ­£ç¡®æ€§ / Index Correctness)

ç´¢å¼•æ˜¯æ­£ç¡®çš„ï¼Œå¦‚æœæœç´¢è¿”å›æ‰€æœ‰åŒ¹é…æ–‡æ¡£ï¼š

$$Correct(Index) \iff \forall Query: Search(Query) = \{Doc | Doc \in Documents \land Match(Doc, Query)\}$$

---

## 2. ç´¢å¼•æ„å»º / Index Construction

### 2.1 ç´¢å¼•æ„å»ºç®—æ³• / Index Construction Algorithm

**å®šä¹‰ 2.1** (ç´¢å¼•æ„å»ºç®—æ³• / Index Construction Algorithm)

ç´¢å¼•æ„å»ºç®—æ³• $BuildIndex(Documents)$ æ„å»ºæ–‡æ¡£ç´¢å¼•ã€‚

**ç®—æ³• 2.1** (ç´¢å¼•æ„å»ºç®—æ³• / Index Construction Algorithm)

```python
def build_index(documents: List[Document]) -> Index:
    """
    æ„å»ºç´¢å¼•
    
    Args:
        documents: æ–‡æ¡£åˆ—è¡¨
        
    Returns:
        Index: ç´¢å¼•
    """
    index = Index()
    
    for doc in documents:
        # æå–å…³é”®è¯
        keywords = extract_keywords(doc)
        
        # æ·»åŠ åˆ°å€’æ’ç´¢å¼•
        for keyword in keywords:
            index.add_to_inverted_index(keyword, doc.id)
        
        # æ·»åŠ åˆ°æ­£å‘ç´¢å¼•
        index.add_to_forward_index(doc.id, doc)
    
    return index
```

**å¼•ç† 2.1** (ç´¢å¼•æ„å»ºæ­£ç¡®æ€§ / Index Construction Correctness)

å¦‚æœæ„å»ºç®—æ³•æ­£ç¡®ï¼Œåˆ™ç´¢å¼•æ­£ç¡®ï¼š

$$Correct(Build) \implies Correct(Index)$$

---

## 3. æœç´¢ç®—æ³• / Search Algorithms

### 3.1 æœç´¢å®šä¹‰ / Search Definition

**å®šä¹‰ 3.1** (æœç´¢ / Search)

æœç´¢ $Search(Query, Index)$ åœ¨ç´¢å¼•ä¸­æŸ¥æ‰¾åŒ¹é…æ–‡æ¡£ï¼š

$$Search(Query, Index) = \{Doc | Doc \in Documents \land Match(Doc, Query)\}$$

**ç®—æ³• 3.1** (æœç´¢ç®—æ³• / Search Algorithm)

```python
def search(query: Query, index: Index) -> List[Document]:
    """
    æœç´¢
    
    Args:
        query: æŸ¥è¯¢
        index: ç´¢å¼•
        
    Returns:
        List[Document]: åŒ¹é…çš„æ–‡æ¡£åˆ—è¡¨
    """
    # è§£ææŸ¥è¯¢
    keywords = parse_query(query)
    
    # æŸ¥æ‰¾åŒ¹é…æ–‡æ¡£
    matched_docs = []
    for keyword in keywords:
        doc_ids = index.get_documents(keyword)
        matched_docs.extend(doc_ids)
    
    # å»é‡å’Œæ’åº
    matched_docs = deduplicate_and_sort(matched_docs)
    
    return matched_docs
```

**å¼•ç† 3.1** (æœç´¢å®Œæ•´æ€§ / Search Completeness)

å¦‚æœæœç´¢ç®—æ³•æ­£ç¡®ï¼Œåˆ™æœç´¢å®Œæ•´ï¼š

$$Correct(Search) \implies Complete(Search)$$

---

## 4. æŸ¥è¯¢ä¼˜åŒ– / Query Optimization

### 4.1 ä¼˜åŒ–å®šä¹‰ / Optimization Definition

**å®šä¹‰ 4.1** (æŸ¥è¯¢ä¼˜åŒ– / Query Optimization)

æŸ¥è¯¢ä¼˜åŒ– $Optimize(Query)$ ä¼˜åŒ–æŸ¥è¯¢ä»¥æé«˜æ•ˆç‡ï¼š

$$Optimize(Query) = OptimizedQuery$$

**ç®—æ³• 4.1** (ä¼˜åŒ–ç®—æ³• / Optimization Algorithm)

```python
def optimize_query(query: Query) -> Query:
    """
    ä¼˜åŒ–æŸ¥è¯¢
    
    Args:
        query: æŸ¥è¯¢
        
    Returns:
        Query: ä¼˜åŒ–åçš„æŸ¥è¯¢
    """
    # ç§»é™¤å†—ä½™æ¡ä»¶
    query = remove_redundant_conditions(query)
    
    # é‡æ’åºæ¡ä»¶
    query = reorder_conditions(query)
    
    # åˆå¹¶ç›¸ä¼¼æ¡ä»¶
    query = merge_similar_conditions(query)
    
    return query
```

---

## 5. å½¢å¼åŒ–è¯æ˜ / Formal Proofs

### 5.1 ç´¢å¼•æ­£ç¡®æ€§ / Index Correctness

**å®šç† 5.1** (ç´¢å¼•æ­£ç¡®æ€§ / Index Correctness)

å¦‚æœæ„å»ºç®—æ³•æ­£ç¡®ï¼Œåˆ™ç´¢å¼•æ­£ç¡®ï¼š

$$Correct(Build) \implies Correct(Index)$$

**è¯æ˜**ï¼š

æ ¹æ®å¼•ç†2.1ï¼Œå¦‚æœæ„å»ºç®—æ³•æ­£ç¡®ï¼Œç´¢å¼•æ­£ç¡®ã€‚å› æ­¤ï¼Œå¦‚æœæ„å»ºç®—æ³•æ­£ç¡®ï¼Œç´¢å¼•æ­£ç¡®ã€‚$\square$

### 5.2 æœç´¢å®Œæ•´æ€§ / Search Completeness

**å®šç† 5.2** (æœç´¢å®Œæ•´æ€§ / Search Completeness)

å¦‚æœæœç´¢ç®—æ³•æ­£ç¡®ï¼Œåˆ™æœç´¢å®Œæ•´ï¼š

$$Correct(Search) \implies Complete(Search)$$

**è¯æ˜**ï¼š

æ ¹æ®å¼•ç†3.1ï¼Œå¦‚æœæœç´¢ç®—æ³•æ­£ç¡®ï¼Œæœç´¢å®Œæ•´ã€‚å› æ­¤ï¼Œå¦‚æœæœç´¢ç®—æ³•æ­£ç¡®ï¼Œæœç´¢å®Œæ•´ã€‚$\square$

---

## 6. ä»£ç å®ç° / Code Implementation

### 6.1 ç´¢å¼•æœç´¢ç³»ç»Ÿ / Indexing and Search System

```python
from dataclasses import dataclass
from typing import List, Dict, Set, Optional, Any
from collections import defaultdict
import re

@dataclass
class Document:
    """æ–‡æ¡£"""
    id: str
    content: str
    metadata: Dict[str, Any] = None
    
    def __post_init__(self):
        if self.metadata is None:
            self.metadata = {}

@dataclass
class Query:
    """æŸ¥è¯¢"""
    keywords: List[str]
    filters: Dict[str, Any] = None
    
    def __post_init__(self):
        if self.filters is None:
            self.filters = {}

class InvertedIndex:
    """å€’æ’ç´¢å¼•"""
    
    def __init__(self):
        self.index: Dict[str, Set[str]] = defaultdict(set)
    
    def add(self, keyword: str, doc_id: str):
        """
        æ·»åŠ ç´¢å¼•é¡¹
        
        Args:
            keyword: å…³é”®è¯
            doc_id: æ–‡æ¡£ID
        """
        self.index[keyword].add(doc_id)
    
    def get_documents(self, keyword: str) -> Set[str]:
        """
        è·å–åŒ…å«å…³é”®è¯çš„æ–‡æ¡£ID
        
        Args:
            keyword: å…³é”®è¯
            
        Returns:
            Set[str]: æ–‡æ¡£IDé›†åˆ
        """
        return self.index.get(keyword, set())
    
    def search(self, keywords: List[str]) -> Set[str]:
        """
        æœç´¢å¤šä¸ªå…³é”®è¯
        
        Args:
            keywords: å…³é”®è¯åˆ—è¡¨
            
        Returns:
            Set[str]: åŒ¹é…çš„æ–‡æ¡£IDé›†åˆ
        """
        if not keywords:
            return set()
        
        # äº¤é›†ï¼šæ‰€æœ‰å…³é”®è¯éƒ½å‡ºç°
        result = self.get_documents(keywords[0])
        for keyword in keywords[1:]:
            result = result.intersection(self.get_documents(keyword))
        
        return result

class ForwardIndex:
    """æ­£å‘ç´¢å¼•"""
    
    def __init__(self):
        self.index: Dict[str, Document] = {}
    
    def add(self, doc_id: str, document: Document):
        """
        æ·»åŠ æ–‡æ¡£
        
        Args:
            doc_id: æ–‡æ¡£ID
            document: æ–‡æ¡£
        """
        self.index[doc_id] = document
    
    def get(self, doc_id: str) -> Optional[Document]:
        """
        è·å–æ–‡æ¡£
        
        Args:
            doc_id: æ–‡æ¡£ID
            
        Returns:
            Optional[Document]: æ–‡æ¡£
        """
        return self.index.get(doc_id)

class IndexBuilder:
    """ç´¢å¼•æ„å»ºå™¨"""
    
    def __init__(self):
        self.inverted_index = InvertedIndex()
        self.forward_index = ForwardIndex()
    
    def build(self, documents: List[Document]):
        """
        æ„å»ºç´¢å¼•
        
        Args:
            documents: æ–‡æ¡£åˆ—è¡¨
        """
        for doc in documents:
            # æ·»åŠ åˆ°æ­£å‘ç´¢å¼•
            self.forward_index.add(doc.id, doc)
            
            # æå–å…³é”®è¯
            keywords = self._extract_keywords(doc.content)
            
            # æ·»åŠ åˆ°å€’æ’ç´¢å¼•
            for keyword in keywords:
                self.inverted_index.add(keyword, doc.id)
    
    def _extract_keywords(self, content: str) -> List[str]:
        """æå–å…³é”®è¯"""
        # ç®€å•çš„å…³é”®è¯æå–ï¼šåˆ†è¯
        words = re.findall(r'\b\w+\b', content.lower())
        # è¿‡æ»¤åœç”¨è¯
        stop_words = {'the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by'}
        keywords = [w for w in words if w not in stop_words and len(w) > 2]
        return keywords

class SearchEngine:
    """æœç´¢å¼•æ“"""
    
    def __init__(self, index_builder: IndexBuilder):
        self.index_builder = index_builder
    
    def search(self, query: Query) -> List[Document]:
        """
        æœç´¢
        
        Args:
            query: æŸ¥è¯¢
            
        Returns:
            List[Document]: åŒ¹é…çš„æ–‡æ¡£åˆ—è¡¨
        """
        # æœç´¢å…³é”®è¯
        doc_ids = self.index_builder.inverted_index.search(query.keywords)
        
        # è·å–æ–‡æ¡£
        documents = []
        for doc_id in doc_ids:
            doc = self.index_builder.forward_index.get(doc_id)
            if doc:
                # åº”ç”¨è¿‡æ»¤å™¨
                if self._match_filters(doc, query.filters):
                    documents.append(doc)
        
        return documents
    
    def _match_filters(self, doc: Document, filters: Dict[str, Any]) -> bool:
        """åŒ¹é…è¿‡æ»¤å™¨"""
        if not filters:
            return True
        
        for key, value in filters.items():
            if key not in doc.metadata or doc.metadata[key] != value:
                return False
        
        return True

class QueryOptimizer:
    """æŸ¥è¯¢ä¼˜åŒ–å™¨"""
    
    def optimize(self, query: Query) -> Query:
        """
        ä¼˜åŒ–æŸ¥è¯¢
        
        Args:
            query: æŸ¥è¯¢
            
        Returns:
            Query: ä¼˜åŒ–åçš„æŸ¥è¯¢
        """
        # å»é‡å…³é”®è¯
        unique_keywords = list(set(query.keywords))
        
        # æ’åºå…³é”®è¯ï¼ˆæŒ‰é¢‘ç‡ï¼Œé¢‘ç‡é«˜çš„åœ¨å‰ï¼‰
        # è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…åº”è¯¥æ ¹æ®ç´¢å¼•ç»Ÿè®¡
        optimized_keywords = sorted(unique_keywords)
        
        return Query(keywords=optimized_keywords, filters=query.filters)

class IndexingSearchSystem:
    """ç´¢å¼•æœç´¢ç³»ç»Ÿ"""
    
    def __init__(self):
        self.index_builder = IndexBuilder()
        self.search_engine = SearchEngine(self.index_builder)
        self.query_optimizer = QueryOptimizer()
    
    def index_documents(self, documents: List[Document]):
        """
        ç´¢å¼•æ–‡æ¡£
        
        Args:
            documents: æ–‡æ¡£åˆ—è¡¨
        """
        self.index_builder.build(documents)
    
    def search(self, query: Query) -> List[Document]:
        """
        æœç´¢
        
        Args:
            query: æŸ¥è¯¢
            
        Returns:
            List[Document]: åŒ¹é…çš„æ–‡æ¡£åˆ—è¡¨
        """
        # ä¼˜åŒ–æŸ¥è¯¢
        optimized_query = self.query_optimizer.optimize(query)
        
        # æ‰§è¡Œæœç´¢
        results = self.search_engine.search(optimized_query)
        
        return results
```

---

## 7. åº”ç”¨æ¡ˆä¾‹ / Application Cases

### 7.1 è½¬æ¢ç´¢å¼•æœç´¢ / Transformation Indexing and Search

**åœºæ™¯**ï¼šä¸ºè½¬æ¢æ¨¡å‹æ„å»ºç´¢å¼•å’Œæœç´¢

**å®ç°**ï¼š

```python
# åˆ›å»ºç´¢å¼•æœç´¢ç³»ç»Ÿ
search_system = IndexingSearchSystem()

# å®šä¹‰æ–‡æ¡£
doc1 = Document(
    id="doc1",
    content="Petri net transformation FSM to Petri net",
    metadata={"type": "transformation", "source": "fsm"}
)

doc2 = Document(
    id="doc2",
    content="BPMN workflow net transformation",
    metadata={"type": "transformation", "source": "bpmn"}
)

# ç´¢å¼•æ–‡æ¡£
search_system.index_documents([doc1, doc2])

# æœç´¢
query = Query(keywords=["petri", "net"], filters={"type": "transformation"})
results = search_system.search(query)

print(f"æ‰¾åˆ° {len(results)} ä¸ªåŒ¹é…æ–‡æ¡£")
for doc in results:
    print(f"  - {doc.id}: {doc.content[:50]}...")
```

### 7.2 æŸ¥è¯¢ä¼˜åŒ– / Query Optimization

**åœºæ™¯**ï¼šä¼˜åŒ–æœç´¢æŸ¥è¯¢

**å®ç°**ï¼š

```python
# åˆ›å»ºæŸ¥è¯¢
query = Query(keywords=["petri", "net", "transformation", "petri"])

# ä¼˜åŒ–æŸ¥è¯¢
optimized = search_system.query_optimizer.optimize(query)
print(f"åŸå§‹æŸ¥è¯¢å…³é”®è¯: {query.keywords}")
print(f"ä¼˜åŒ–åå…³é”®è¯: {optimized.keywords}")
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: GraphNetWorkCommunicateé¡¹ç›®ç»„
