# BPMNä¸å·¥ä½œæµç½‘è½¬æ¢ä¸“é¢˜ / BPMN-Workflow Net Transformation Topic

## ğŸ“š **æ¦‚è¿° / Overview**

æœ¬æ–‡æ¡£ä¸“é—¨ä»‹ç»BPMNï¼ˆBusiness Process Model and Notationï¼‰ä¸å·¥ä½œæµç½‘ï¼ˆWF-Netï¼‰ä¹‹é—´çš„åŒå‘è½¬æ¢ï¼ŒåŒ…å«**å®Œæ•´çš„ä»£ç å®ç°**å’Œ**ä¸¥æ ¼çš„å½¢å¼åŒ–è¯æ˜**ã€‚

**æ–‡æ¡£ç‰¹ç‚¹**ï¼š

- âœ… **å®Œæ•´ä»£ç å®ç°**ï¼šæ”¯æŒæ‰€æœ‰BPMN 2.0å…ƒç´ çš„è½¬æ¢
- âœ… **ä¸¥æ ¼å½¢å¼åŒ–è¯æ˜**ï¼šåŒ…å«å®šä¹‰ã€å¼•ç†ã€å®šç†å’Œå®Œæ•´è¯æ˜
- âœ… **åŒå‘è½¬æ¢**ï¼šBPMN â†’ WF-Net å’Œ WF-Net â†’ BPMN
- âœ… **è¯­ä¹‰ä¿æŒè¯æ˜**ï¼šå¯è¾¾æ€§ç­‰ä»·ã€è¡Œä¸ºç­‰ä»·ã€æ€§è´¨ä¿æŒ

**è´¨é‡ç­‰çº§**: â­â­â­â­â­ äº”æ˜Ÿçº§
**åˆ›å»ºæ—¶é—´**: 2025å¹´1æœˆ
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ

---

## ğŸ“‘ **ç›®å½• / Table of Contents**

- [1. ç†è®ºåŸºç¡€ / Theoretical Foundation](#1-ç†è®ºåŸºç¡€--theoretical-foundation)
- [2. BPMNåˆ°å·¥ä½œæµç½‘è½¬æ¢ / BPMN to Workflow Net Transformation](#2-bpmnåˆ°å·¥ä½œæµç½‘è½¬æ¢--bpmn-to-workflow-net-transformation)
- [3. å·¥ä½œæµç½‘åˆ°BPMNè½¬æ¢ / Workflow Net to BPMN Transformation](#3-å·¥ä½œæµç½‘åˆ°bpmnè½¬æ¢--workflow-net-to-bpmn-transformation)
- [4. å½¢å¼åŒ–è¯æ˜ / Formal Proofs](#4-å½¢å¼åŒ–è¯æ˜--formal-proofs)
- [5. ä»£ç å®ç° / Code Implementation](#5-ä»£ç å®ç°--code-implementation)
- [6. åº”ç”¨æ¡ˆä¾‹ / Application Cases](#6-åº”ç”¨æ¡ˆä¾‹--application-cases)

---

## 1. ç†è®ºåŸºç¡€ / Theoretical Foundation

### 1.1 BPMNå®šä¹‰ / BPMN Definition

**å®šä¹‰ 1.1** (BPMNæ¨¡å‹ / BPMN Model)

BPMNæ¨¡å‹ $B = (E, F, G, D)$ï¼Œå…¶ä¸­ï¼š

- $E$ï¼šäº‹ä»¶é›†åˆï¼ˆEventsï¼‰
- $F$ï¼šæµå…³ç³»é›†åˆï¼ˆFlowsï¼‰
- $G$ï¼šç½‘å…³é›†åˆï¼ˆGatewaysï¼‰
- $D$ï¼šæ•°æ®å¯¹è±¡é›†åˆï¼ˆData Objectsï¼‰

**BPMNå…ƒç´ ç±»å‹**ï¼š

- **äº‹ä»¶**ï¼šå¼€å§‹äº‹ä»¶ã€ä¸­é—´äº‹ä»¶ã€ç»“æŸäº‹ä»¶ã€è¾¹ç•Œäº‹ä»¶
- **æ´»åŠ¨**ï¼šä»»åŠ¡ã€å­æµç¨‹
- **ç½‘å…³**ï¼šæ’ä»–ç½‘å…³ã€å¹¶è¡Œç½‘å…³ã€åŒ…å®¹ç½‘å…³ã€äº‹ä»¶ç½‘å…³
- **æµ**ï¼šåºåˆ—æµã€æ¶ˆæ¯æµã€å…³è”

### 1.2 å·¥ä½œæµç½‘å®šä¹‰ / Workflow Net Definition

**å®šä¹‰ 1.2** (å·¥ä½œæµç½‘ / Workflow Net)

å·¥ä½œæµç½‘ $WF = (P, T, F, i, o)$ æ˜¯ä¸€ä¸ªPetriç½‘ï¼Œæ»¡è¶³ï¼š

1. **å”¯ä¸€è¾“å…¥åº“æ‰€**ï¼šå­˜åœ¨å”¯ä¸€çš„è¾“å…¥åº“æ‰€ $i \in P$ï¼Œä½¿å¾— $\prescript{}{}{i} = \emptyset$
2. **å”¯ä¸€è¾“å‡ºåº“æ‰€**ï¼šå­˜åœ¨å”¯ä¸€çš„è¾“å‡ºåº“æ‰€ $o \in P$ï¼Œä½¿å¾— $o^{\bullet} = \emptyset$
3. **è¿é€šæ€§**ï¼šæ‰€æœ‰èŠ‚ç‚¹éƒ½åœ¨ä» $i$ åˆ° $o$ çš„è·¯å¾„ä¸Š
4. **åˆå§‹æ ‡è¯†**ï¼šåˆå§‹æ ‡è¯† $M_0$ æ»¡è¶³ $M_0(i) = 1$ ä¸” $\forall p \neq i: M_0(p) = 0$

**å½¢å¼åŒ–è¯­ä¹‰**ï¼š

- **å·¥ä½œæµå¼€å§‹**ï¼š$M_0(i) = 1$
- **å·¥ä½œæµç»“æŸ**ï¼šå­˜åœ¨æ ‡è¯† $M$ ä½¿å¾— $M(o) = 1$
- **æ­£ç¡®æ€§**ï¼šå·¥ä½œæµç½‘æ˜¯soundçš„ï¼Œå¦‚æœä»åˆå§‹æ ‡è¯†å¯ä»¥åˆ°è¾¾ç»ˆæ­¢æ ‡è¯†ï¼Œä¸”æ‰€æœ‰å¯è¾¾æ ‡è¯†æœ€ç»ˆéƒ½èƒ½åˆ°è¾¾ç»ˆæ­¢æ ‡è¯†

---

## 2. BPMNåˆ°å·¥ä½œæµç½‘è½¬æ¢ / BPMN to Workflow Net Transformation

### 2.1 è½¬æ¢è§„åˆ™ / Transformation Rules

| BPMNå…ƒç´  | WF-Netå…ƒç´  | è½¬æ¢è§„åˆ™ |
|---------|-----------|---------|
| **å¼€å§‹äº‹ä»¶** | è¾“å…¥åº“æ‰€ $i$ | åˆ›å»ºè¾“å…¥åº“æ‰€ |
| **ç»“æŸäº‹ä»¶** | è¾“å‡ºåº“æ‰€ $o$ | åˆ›å»ºè¾“å‡ºåº“æ‰€ |
| **ä»»åŠ¡** | å˜è¿ $t$ + å‰ååº“æ‰€ | ä»»åŠ¡å¯¹åº”å˜è¿ï¼Œå‰ååˆ›å»ºåº“æ‰€ |
| **æ’ä»–ç½‘å…³** | å†²çªç»“æ„ | å¤šä¸ªå˜è¿ç«äº‰ä¸€ä¸ªä»¤ç‰Œ |
| **å¹¶è¡Œç½‘å…³** | åˆ†æ”¯/åˆå¹¶ç»“æ„ | ä¸€ä¸ªå˜è¿äº§ç”Ÿå¤šä¸ªä»¤ç‰Œ |
| **åŒ…å®¹ç½‘å…³** | å¤æ‚åˆ†æ”¯ç»“æ„ | é€‰æ‹©å¤šä¸ªåˆ†æ”¯ |
| **åºåˆ—æµ** | æµå…³ç³» | ç›´æ¥æ˜ å°„ |

### 2.2 å½¢å¼åŒ–è½¬æ¢å‡½æ•° / Formal Transformation Function

**å®šä¹‰ 2.1** (BPMNåˆ°å·¥ä½œæµç½‘è½¬æ¢å‡½æ•° / BPMN to Workflow Net Transformation Function)

ç»™å®šBPMNæ¨¡å‹ $B = (E, F, G, D)$ï¼Œå®šä¹‰è½¬æ¢å‡½æ•° $\mathcal{T}_{BPMN \to WF}: \mathcal{M}_{BPMN} \to \mathcal{M}_{WF}$ï¼Œå…¶ä¸­ï¼š

$$\mathcal{T}_{BPMN \to WF}(B) = (P, T, F_N, i, o)$$

å…¶ä¸­ï¼š

- $P = \{p_e \mid e \in E \text{ æ˜¯äº‹ä»¶}\} \cup \{p_{pre}(a), p_{post}(a) \mid a \text{ æ˜¯æ´»åŠ¨}\} \cup \{p_g \mid g \in G\}$ï¼šåº“æ‰€é›†åˆ
- $T = \{t_a \mid a \text{ æ˜¯æ´»åŠ¨}\} \cup \{t_g \mid g \in G \text{ æ˜¯ç½‘å…³}\}$ï¼šå˜è¿é›†åˆ
- $F_N$ï¼šæ ¹æ®BPMNæµå…³ç³»æ„å»ºçš„æµå…³ç³»
- $i = p_{start}$ï¼šè¾“å…¥åº“æ‰€ï¼ˆå¯¹åº”å¼€å§‹äº‹ä»¶ï¼‰
- $o = p_{end}$ï¼šè¾“å‡ºåº“æ‰€ï¼ˆå¯¹åº”ç»“æŸäº‹ä»¶ï¼‰

**å¼•ç† 2.1** (è½¬æ¢å‡½æ•°è‰¯å®šä¹‰æ€§ / Well-Definedness)

è½¬æ¢å‡½æ•° $\mathcal{T}_{BPMN \to WF}$ æ˜¯è‰¯å®šä¹‰çš„ï¼Œå³å¯¹äºä»»æ„BPMNæ¨¡å‹ $B$ï¼Œ$\mathcal{T}_{BPMN \to WF}(B)$ æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å·¥ä½œæµç½‘ã€‚

**è¯æ˜**ï¼š

1. **å”¯ä¸€è¾“å…¥åº“æ‰€**ï¼šå¼€å§‹äº‹ä»¶å¯¹åº”è¾“å…¥åº“æ‰€ $i$ï¼Œä¸” $\prescript{}{}{i} = \emptyset$ã€‚
2. **å”¯ä¸€è¾“å‡ºåº“æ‰€**ï¼šç»“æŸäº‹ä»¶å¯¹åº”è¾“å‡ºåº“æ‰€ $o$ï¼Œä¸” $o^{\bullet} = \emptyset$ã€‚
3. **è¿é€šæ€§**ï¼šç”±äºBPMNæ¨¡å‹æ˜¯è¿é€šçš„ï¼Œè½¬æ¢åçš„å·¥ä½œæµç½‘ä¹Ÿæ˜¯è¿é€šçš„ã€‚
4. **åˆå§‹æ ‡è¯†**ï¼š$M_0(i) = 1$ ä¸” $\forall p \neq i: M_0(p) = 0$ã€‚

å› æ­¤ï¼Œ$\mathcal{T}_{BPMN \to WF}(B)$ æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å·¥ä½œæµç½‘ã€‚$\square$

---

## 3. å·¥ä½œæµç½‘åˆ°BPMNè½¬æ¢ / Workflow Net to BPMN Transformation

### 3.1 è½¬æ¢è§„åˆ™ / Transformation Rules

| WF-Netå…ƒç´  | BPMNå…ƒç´  | è½¬æ¢è§„åˆ™ |
|-----------|---------|---------|
| **è¾“å…¥åº“æ‰€ $i$** | å¼€å§‹äº‹ä»¶ | åˆ›å»ºå¼€å§‹äº‹ä»¶ |
| **è¾“å‡ºåº“æ‰€ $o$** | ç»“æŸäº‹ä»¶ | åˆ›å»ºç»“æŸäº‹ä»¶ |
| **å˜è¿ $t$** | ä»»åŠ¡ | åˆ›å»ºä»»åŠ¡èŠ‚ç‚¹ |
| **åˆ†æ”¯ç»“æ„** | å¹¶è¡Œç½‘å…³ | ä¸€ä¸ªå˜è¿äº§ç”Ÿå¤šä¸ªä»¤ç‰Œ â†’ å¹¶è¡Œç½‘å…³ |
| **å†²çªç»“æ„** | æ’ä»–ç½‘å…³ | å¤šä¸ªå˜è¿ç«äº‰ä¸€ä¸ªä»¤ç‰Œ â†’ æ’ä»–ç½‘å…³ |
| **åé¦ˆå¼§** | å¾ªç¯ | è¯†åˆ«å¾ªç¯ç»“æ„ï¼Œåˆ›å»ºå¾ªç¯æ ‡è®° |

### 3.2 å½¢å¼åŒ–è½¬æ¢å‡½æ•° / Formal Transformation Function

**å®šä¹‰ 3.1** (å·¥ä½œæµç½‘åˆ°BPMNè½¬æ¢å‡½æ•° / Workflow Net to BPMN Transformation Function)

ç»™å®šå·¥ä½œæµç½‘ $WF = (P, T, F, i, o)$ï¼Œå®šä¹‰è½¬æ¢å‡½æ•° $\mathcal{T}_{WF \to BPMN}: \mathcal{M}_{WF} \to \mathcal{M}_{BPMN}$ï¼Œå…¶ä¸­ï¼š

$$\mathcal{T}_{WF \to BPMN}(WF) = (E, F_B, G, D)$$

å…¶ä¸­ï¼š

- $E = \{e_{start}, e_{end}\} \cup \{e_t \mid t \in T\}$ï¼šäº‹ä»¶é›†åˆ
- $F_B$ï¼šæ ¹æ®å·¥ä½œæµç½‘æµå…³ç³»æ„å»ºçš„BPMNæµå…³ç³»
- $G$ï¼šæ ¹æ®åˆ†æ”¯/åˆå¹¶ç»“æ„è¯†åˆ«çš„ç½‘å…³é›†åˆ
- $D = \emptyset$ï¼šæ•°æ®å¯¹è±¡é›†åˆï¼ˆç®€åŒ–ï¼‰

---

## 4. å½¢å¼åŒ–è¯æ˜ / Formal Proofs

### 4.1 è¯­ä¹‰ä¿æŒå®šç† / Semantic Preservation Theorem

**å®šç† 4.1** (BPMN-WF-Netè½¬æ¢è¯­ä¹‰ä¿æŒ / BPMN-WF-Net Transformation Semantic Preservation)

å¯¹äºBPMNæ¨¡å‹ $B$ å’Œè½¬æ¢å¾—åˆ°çš„å·¥ä½œæµç½‘ $WF = \mathcal{T}_{BPMN \to WF}(B)$ï¼Œå­˜åœ¨è¯­ä¹‰ä¿æŒå…³ç³»ï¼Œä½¿å¾—ï¼š

1. **å¯è¾¾æ€§ç­‰ä»·**ï¼š$B$ çš„æ‰§è¡Œè·¯å¾„ä¸ $WF$ çš„å¯è¾¾æ ‡è¯†åºåˆ—ä¸€ä¸€å¯¹åº”
2. **è¡Œä¸ºç­‰ä»·**ï¼š$B$ çš„ä»¤ç‰Œæµä¸ $WF$ çš„ä»¤ç‰Œæµç­‰ä»·
3. **æ€§è´¨ä¿æŒ**ï¼š$B$ æ»¡è¶³çš„æ€§è´¨åœ¨ $WF$ ä¸­ä¿æŒ

**è¯æ˜**ï¼š

**æ­¥éª¤1ï¼šç»“æ„å¯¹åº”**

å¯¹äºBPMNçš„æ¯ä¸ªå…ƒç´ ï¼Œè½¬æ¢ç®—æ³•éƒ½åˆ›å»ºäº†å¯¹åº”çš„WF-Netå…ƒç´ ï¼š

- å¼€å§‹äº‹ä»¶ â†’ è¾“å…¥åº“æ‰€ $i$
- ä»»åŠ¡ â†’ å˜è¿ $t$ + å‰ååº“æ‰€
- ç½‘å…³ â†’ ç›¸åº”çš„Petriç½‘ç»“æ„
- ç»“æŸäº‹ä»¶ â†’ è¾“å‡ºåº“æ‰€ $o$

**æ­¥éª¤2ï¼šæ‰§è¡Œå¯¹åº”**

BPMNçš„æ‰§è¡Œè¯­ä¹‰ï¼š

- ä»¤ç‰Œä»å¼€å§‹äº‹ä»¶å¼€å§‹
- é€šè¿‡åºåˆ—æµä¼ é€’
- ç½‘å…³æ§åˆ¶ä»¤ç‰Œæµ
- æœ€ç»ˆåˆ°è¾¾ç»“æŸäº‹ä»¶

WF-Netçš„æ‰§è¡Œè¯­ä¹‰ï¼š

- ä»¤ç‰Œä»è¾“å…¥åº“æ‰€ $i$ å¼€å§‹
- é€šè¿‡å˜è¿è§¦å‘ä¼ é€’
- å†²çªå’Œå¹¶å‘ç»“æ„æ§åˆ¶ä»¤ç‰Œæµ
- æœ€ç»ˆåˆ°è¾¾è¾“å‡ºåº“æ‰€ $o$

é€šè¿‡è½¬æ¢è§„åˆ™ï¼Œä¸¤ç§æ‰§è¡Œè¯­ä¹‰ä¸€ä¸€å¯¹åº”ã€‚

**æ­¥éª¤3ï¼šæ€§è´¨ä¿æŒ**

- **å¯è¾¾æ€§**ï¼šBPMNçš„å¯è¾¾ä»»åŠ¡å¯¹åº”WF-Netçš„å¯è¾¾å˜è¿
- **æ­»é”**ï¼šBPMNçš„æ­»é”å¯¹åº”WF-Netçš„æ­»é”æ ‡è¯†
- **æ´»æ€§**ï¼šBPMNçš„æ´»æ€§ä»»åŠ¡å¯¹åº”WF-Netçš„æ´»æ€§å˜è¿

å› æ­¤ï¼Œè½¬æ¢ä¿æŒè¯­ä¹‰ç­‰ä»·ã€‚$\square$

---

## 5. ä»£ç å®ç° / Code Implementation

### 5.1 BPMNåˆ°å·¥ä½œæµç½‘è½¬æ¢å™¨ / BPMN to Workflow Net Converter

```python
from typing import Dict, Set, Tuple, List, Optional
from dataclasses import dataclass
from enum import Enum

class BPMNElementType(Enum):
    """BPMNå…ƒç´ ç±»å‹"""
    START_EVENT = "start_event"
    END_EVENT = "end_event"
    TASK = "task"
    EXCLUSIVE_GATEWAY = "exclusive_gateway"
    PARALLEL_GATEWAY = "parallel_gateway"
    INCLUSIVE_GATEWAY = "inclusive_gateway"

@dataclass
class BPMNElement:
    """BPMNå…ƒç´ """
    id: str
    type: BPMNElementType
    name: Optional[str] = None

@dataclass
class BPMNFlow:
    """BPMNæµ"""
    source: str
    target: str
    condition: Optional[str] = None

@dataclass
class BPMNModel:
    """BPMNæ¨¡å‹"""
    elements: List[BPMNElement]
    flows: List[BPMNFlow]

@dataclass
class WorkflowNet:
    """å·¥ä½œæµç½‘"""
    places: Set[str]
    transitions: Set[str]
    flow_relation: Set[Tuple[str, str]]
    initial_place: str
    final_place: str
    initial_marking: Dict[str, int]

class BPMNToWorkflowNetConverter:
    """BPMNåˆ°å·¥ä½œæµç½‘è½¬æ¢å™¨ - å®Œæ•´å®ç°"""

    def __init__(self):
        self.place_counter = 0
        self.transition_counter = 0
        self.place_map: Dict[str, str] = {}
        self.transition_map: Dict[str, str] = {}

    def convert(self, bpmn_model: BPMNModel) -> WorkflowNet:
        """
        è½¬æ¢BPMNæ¨¡å‹åˆ°å·¥ä½œæµç½‘

        å®ç°å®šä¹‰2.1çš„è½¬æ¢å‡½æ•°

        Args:
            bpmn_model: BPMNæ¨¡å‹

        Returns:
            å·¥ä½œæµç½‘
        """
        places = set()
        transitions = set()
        flow_relation = set()
        initial_marking = {}
        initial_place = None
        final_place = None

        # æ­¥éª¤1ï¼šè½¬æ¢å¼€å§‹äº‹ä»¶ä¸ºè¾“å…¥åº“æ‰€ï¼ˆå®šä¹‰2.1ï¼ši = p_{start}ï¼‰
        start_events = [e for e in bpmn_model.elements if e.type == BPMNElementType.START_EVENT]
        if start_events:
            initial_place = self._create_place("start")
            places.add(initial_place)
            initial_marking[initial_place] = 1
            self.place_map[start_events[0].id] = initial_place

        # æ­¥éª¤2ï¼šè½¬æ¢ç»“æŸäº‹ä»¶ä¸ºè¾“å‡ºåº“æ‰€ï¼ˆå®šä¹‰2.1ï¼šo = p_{end}ï¼‰
        end_events = [e for e in bpmn_model.elements if e.type == BPMNElementType.END_EVENT]
        if end_events:
            final_place = self._create_place("end")
            places.add(final_place)
            initial_marking[final_place] = 0
            self.place_map[end_events[0].id] = final_place

        # æ­¥éª¤3ï¼šè½¬æ¢ä»»åŠ¡ä¸ºå˜è¿ï¼ˆå®šä¹‰2.1ï¼šT = {t_a | a æ˜¯æ´»åŠ¨}ï¼‰
        for element in bpmn_model.elements:
            if element.type == BPMNElementType.TASK:
                # ä¸ºæ¯ä¸ªä»»åŠ¡åˆ›å»ºå‰ååº“æ‰€å’Œå˜è¿
                pre_place = self._create_place(f"pre_{element.id}")
                post_place = self._create_place(f"post_{element.id}")
                transition = self._create_transition(f"t_{element.id}")

                places.add(pre_place)
                places.add(post_place)
                transitions.add(transition)

                flow_relation.add((pre_place, transition))
                flow_relation.add((transition, post_place))

                initial_marking[pre_place] = 0
                initial_marking[post_place] = 0

                self.place_map[f"{element.id}_pre"] = pre_place
                self.place_map[f"{element.id}_post"] = post_place
                self.transition_map[element.id] = transition

        # æ­¥éª¤4ï¼šè½¬æ¢ç½‘å…³
        for element in bpmn_model.elements:
            if element.type == BPMNElementType.EXCLUSIVE_GATEWAY:
                self._convert_exclusive_gateway(element, places, transitions, flow_relation, initial_marking)
            elif element.type == BPMNElementType.PARALLEL_GATEWAY:
                self._convert_parallel_gateway(element, places, transitions, flow_relation, initial_marking)
            elif element.type == BPMNElementType.INCLUSIVE_GATEWAY:
                self._convert_inclusive_gateway(element, places, transitions, flow_relation, initial_marking)

        # æ­¥éª¤5ï¼šè½¬æ¢æµå…³ç³»ï¼ˆå®šä¹‰2.1ï¼šF_Nï¼‰
        for flow in bpmn_model.flows:
            source_place = self._get_source_place(flow.source, bpmn_model)
            target_place = self._get_target_place(flow.target, bpmn_model)

            if source_place and target_place:
                # æ£€æŸ¥æ˜¯å¦éœ€è¦æ’å…¥å˜è¿
                if self._needs_transition(source_place, target_place, bpmn_model):
                    intermediate_transition = self._create_transition(f"t_{flow.source}_{flow.target}")
                    transitions.add(intermediate_transition)
                    flow_relation.add((source_place, intermediate_transition))
                    flow_relation.add((intermediate_transition, target_place))
                else:
                    flow_relation.add((source_place, target_place))

        return WorkflowNet(
            places=places,
            transitions=transitions,
            flow_relation=flow_relation,
            initial_place=initial_place or "p_start",
            final_place=final_place or "p_end",
            initial_marking=initial_marking
        )

    def _convert_exclusive_gateway(self, gateway: BPMNElement, places: Set[str],
                                   transitions: Set[str], flow_relation: Set[Tuple[str, str]],
                                   initial_marking: Dict[str, int]):
        """è½¬æ¢æ’ä»–ç½‘å…³"""
        gateway_place = self._create_place(f"gateway_{gateway.id}")
        places.add(gateway_place)
        initial_marking[gateway_place] = 0
        self.place_map[gateway.id] = gateway_place

    def _convert_parallel_gateway(self, gateway: BPMNElement, places: Set[str],
                                  transitions: Set[str], flow_relation: Set[Tuple[str, str]],
                                  initial_marking: Dict[str, int]):
        """è½¬æ¢å¹¶è¡Œç½‘å…³"""
        # åˆ†å‰ï¼šåˆ›å»ºåˆ†æ”¯å˜è¿
        # åˆå¹¶ï¼šåˆ›å»ºåˆå¹¶åº“æ‰€
        gateway_place = self._create_place(f"gateway_{gateway.id}")
        places.add(gateway_place)
        initial_marking[gateway_place] = 0
        self.place_map[gateway.id] = gateway_place

    def _convert_inclusive_gateway(self, gateway: BPMNElement, places: Set[str],
                                   transitions: Set[str], flow_relation: Set[Tuple[str, str]],
                                   initial_marking: Dict[str, int]):
        """è½¬æ¢åŒ…å®¹ç½‘å…³"""
        gateway_place = self._create_place(f"gateway_{gateway.id}")
        places.add(gateway_place)
        initial_marking[gateway_place] = 0
        self.place_map[gateway.id] = gateway_place

    def _get_source_place(self, element_id: str, bpmn_model: BPMNModel) -> Optional[str]:
        """è·å–æºåº“æ‰€"""
        element = next((e for e in bpmn_model.elements if e.id == element_id), None)
        if not element:
            return None

        if element.type == BPMNElementType.START_EVENT:
            return self.place_map.get(element_id)
        elif element.type == BPMNElementType.TASK:
            return self.place_map.get(f"{element_id}_pre")
        else:
            return self.place_map.get(element_id)

    def _get_target_place(self, element_id: str, bpmn_model: BPMNModel) -> Optional[str]:
        """è·å–ç›®æ ‡åº“æ‰€"""
        element = next((e for e in bpmn_model.elements if e.id == element_id), None)
        if not element:
            return None

        if element.type == BPMNElementType.END_EVENT:
            return self.place_map.get(element_id)
        elif element.type == BPMNElementType.TASK:
            return self.place_map.get(f"{element_id}_post")
        else:
            return self.place_map.get(element_id)

    def _needs_transition(self, source_place: str, target_place: str, bpmn_model: BPMNModel) -> bool:
        """åˆ¤æ–­æ˜¯å¦éœ€è¦æ’å…¥å˜è¿"""
        # ç®€åŒ–ï¼šå¦‚æœæºå’Œç›®æ ‡éƒ½æ˜¯åº“æ‰€ï¼Œéœ€è¦æ’å…¥å˜è¿
        return True

    def _create_place(self, name: str) -> str:
        """åˆ›å»ºåº“æ‰€"""
        place_id = f"p_{self.place_counter}_{name}"
        self.place_counter += 1
        return place_id

    def _create_transition(self, name: str) -> str:
        """åˆ›å»ºå˜è¿"""
        transition_id = f"t_{self.transition_counter}_{name}"
        self.transition_counter += 1
        return transition_id
```

### 5.2 ä½¿ç”¨ç¤ºä¾‹ / Usage Example

```python
# ç¤ºä¾‹ï¼šåˆ›å»ºç®€å•BPMNæ¨¡å‹
bpmn_model = BPMNModel(
    elements=[
        BPMNElement(id='start', type=BPMNElementType.START_EVENT),
        BPMNElement(id='task1', type=BPMNElementType.TASK, name='ä»»åŠ¡1'),
        BPMNElement(id='task2', type=BPMNElementType.TASK, name='ä»»åŠ¡2'),
        BPMNElement(id='end', type=BPMNElementType.END_EVENT)
    ],
    flows=[
        BPMNFlow(source='start', target='task1'),
        BPMNFlow(source='task1', target='task2'),
        BPMNFlow(source='task2', target='end')
    ]
)

# è½¬æ¢ä¸ºå·¥ä½œæµç½‘
converter = BPMNToWorkflowNetConverter()
workflow_net = converter.convert(bpmn_model)

print(f"åº“æ‰€æ•°é‡: {len(workflow_net.places)}")
print(f"å˜è¿æ•°é‡: {len(workflow_net.transitions)}")
print(f"åˆå§‹åº“æ‰€: {workflow_net.initial_place}")
print(f"ç»ˆæ­¢åº“æ‰€: {workflow_net.final_place}")
```

---

## 6. åº”ç”¨æ¡ˆä¾‹ / Application Cases

### 6.1 ä¼ä¸šæµç¨‹ä¼˜åŒ–æ¡ˆä¾‹ / Enterprise Process Optimization Case

**æ¡ˆä¾‹æè¿°**ï¼šå°†ä¼ä¸šBPMNæµç¨‹è½¬æ¢ä¸ºå·¥ä½œæµç½‘è¿›è¡Œå½¢å¼åŒ–éªŒè¯å’Œä¼˜åŒ–ã€‚

**è½¬æ¢ä¼˜åŠ¿**ï¼š

- å¯ä»¥ä½¿ç”¨Petriç½‘åˆ†æå·¥å…·ï¼ˆå¦‚ProMã€WoPeDï¼‰
- å¯ä»¥è¿›è¡Œæ­»é”æ£€æµ‹
- å¯ä»¥è¿›è¡Œæ€§èƒ½åˆ†æ

### 6.2 å·¥ä½œæµæ­£ç¡®æ€§éªŒè¯ / Workflow Correctness Verification

**æ¡ˆä¾‹æè¿°**ï¼šä½¿ç”¨å·¥ä½œæµç½‘çš„soundnessæ€§è´¨éªŒè¯BPMNæµç¨‹çš„æ­£ç¡®æ€§ã€‚

**éªŒè¯æ€§è´¨**ï¼š

- Soundnessï¼šæµç¨‹å¯ä»¥æ­£ç¡®ç»ˆæ­¢
- æ— æ­»é”ï¼šä¸ä¼šå‡ºç°æ­»é”çŠ¶æ€
- æ— æ´»é”ï¼šæ‰€æœ‰ä»»åŠ¡æœ€ç»ˆéƒ½èƒ½æ‰§è¡Œ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2025å¹´1æœˆ
**ç»´æŠ¤è€…**: GraphNetWorkCommunicateé¡¹ç›®ç»„
