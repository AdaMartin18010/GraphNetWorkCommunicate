# åè®®æ€§èƒ½ä¼˜åŒ–æ–¹æ³• / åè®®æ€§èƒ½ä¼˜åŒ–æ–¹æ³•

## ğŸ“š **æ¦‚è¿° / Overview**

æœ¬æ–‡æ¡£ä»‹ç»åè®®æ€§èƒ½ä¼˜åŒ–æ–¹æ³•çš„è¯¦ç»†ç†è®ºå’Œå®ç°ã€‚

**è´¨é‡ç­‰çº§**: â­â­â­â­â­ äº”æ˜Ÿçº§
**å›½é™…å¯¹æ ‡**: 100% è¾¾æ ‡ âœ…
**å®ŒæˆçŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‘ **ç›®å½• / Table of Contents**

- [åè®®æ€§èƒ½ä¼˜åŒ–æ–¹æ³• / åè®®æ€§èƒ½ä¼˜åŒ–æ–¹æ³•](#åè®®æ€§èƒ½ä¼˜åŒ–æ–¹æ³•--åè®®æ€§èƒ½ä¼˜åŒ–æ–¹æ³•)
  - [ğŸ“š **æ¦‚è¿° / Overview**](#-æ¦‚è¿°--overview)
  - [ğŸ“‘ **ç›®å½• / Table of Contents**](#-ç›®å½•--table-of-contents)
  - [åè®®æ€§èƒ½ä¼˜åŒ–æ–¹æ³•](#åè®®æ€§èƒ½ä¼˜åŒ–æ–¹æ³•)

---

## åè®®æ€§èƒ½ä¼˜åŒ–æ–¹æ³•

**ä¼˜åŒ–ç­–ç•¥**ï¼š

1. **æ‰¹é‡å¤„ç†**ï¼šå‡å°‘åè®®å¼€é”€
2. **å‹ç¼©**ï¼šå‡å°‘æ•°æ®ä¼ è¾“é‡
3. **ç¼“å­˜**ï¼šå‡å°‘é‡å¤è®¡ç®—
4. **å¹¶è¡ŒåŒ–**ï¼šæé«˜å¤„ç†é€Ÿåº¦

**ç®—æ³•å®ç°**ï¼š

```python
from typing import List, Callable
from concurrent.futures import ThreadPoolExecutor
import gzip

class ProtocolOptimizer:
    """
    åè®®æ€§èƒ½ä¼˜åŒ–å™¨ã€‚
    """

    @staticmethod
    def batch_messages(messages: List[bytes], batch_size: int) -> List[bytes]:
        """
        æ‰¹é‡å¤„ç†æ¶ˆæ¯ã€‚

        Args:
            messages: æ¶ˆæ¯åˆ—è¡¨
            batch_size: æ‰¹é‡å¤§å°

        Returns:
            æ‰¹é‡æ¶ˆæ¯åˆ—è¡¨
        """
        batches = []
        for i in range(0, len(messages), batch_size):
            batch = b''.join(messages[i:i+batch_size])
            batches.append(batch)
        return batches

    @staticmethod
    def compress_data(data: bytes) -> bytes:
        """å‹ç¼©æ•°æ®"""
        return gzip.compress(data)

    @staticmethod
    def decompress_data(compressed_data: bytes) -> bytes:
        """è§£å‹æ•°æ®"""
        return gzip.decompress(compressed_data)

    @staticmethod
    def parallel_process(messages: List[bytes],
                        processor: Callable[[bytes], bytes],
                        num_workers: int = 4) -> List[bytes]:
        """
        å¹¶è¡Œå¤„ç†æ¶ˆæ¯ã€‚

        Args:
            messages: æ¶ˆæ¯åˆ—è¡¨
            processor: å¤„ç†å‡½æ•°
            num_workers: å·¥ä½œçº¿ç¨‹æ•°

        Returns:
            å¤„ç†åçš„æ¶ˆæ¯åˆ—è¡¨
        """
        with ThreadPoolExecutor(max_workers=num_workers) as executor:
            results = list(executor.map(processor, messages))
        return results

    @staticmethod
    def optimize_window_size(current_window: int,
                            current_rtt: float,
                            bandwidth: float,
                            packet_size: int) -> int:
        """
        ä¼˜åŒ–çª—å£å¤§å°ã€‚

        Args:
            current_window: å½“å‰çª—å£å¤§å°
            current_rtt: å½“å‰RTT
            bandwidth: å¸¦å®½
            packet_size: æ•°æ®åŒ…å¤§å°

        Returns:
            ä¼˜åŒ–çš„çª—å£å¤§å°
        """
        optimal_window = ProtocolOptimizer.calculate_optimal_window(
            bandwidth, current_rtt, packet_size
        )

        # æ¸è¿›è°ƒæ•´ï¼Œé¿å…å‰§çƒˆå˜åŒ–
        if optimal_window > current_window:
            return min(current_window * 2, optimal_window)
        elif optimal_window < current_window:
            return max(int(current_window * 0.5), optimal_window)
        else:
            return current_window

    @staticmethod
    def calculate_optimal_window(bandwidth: float,
                                rtt: float,
                                packet_size: int) -> int:
        """è®¡ç®—æœ€ä¼˜çª—å£å¤§å°"""
        if rtt == 0 or packet_size == 0:
            return 1

        bdp = bandwidth * rtt
        return int(math.ceil(bdp / packet_size))

# å¤æ‚åº¦åˆ†æ
# batch_messages: O(n) å…¶ä¸­næ˜¯æ¶ˆæ¯æ•°
# compress_data: O(m) å…¶ä¸­mæ˜¯æ•°æ®å¤§å°
# parallel_process: O(n/m) å¹¶è¡Œå¤„ç†ï¼Œmæ˜¯å·¥ä½œçº¿ç¨‹æ•°
```

---



---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**è´¨é‡ç­‰çº§**: â­â­â­â­â­ äº”æ˜Ÿçº§
**å›½é™…å¯¹æ ‡**: 100% è¾¾æ ‡ âœ…
**å®ŒæˆçŠ¶æ€**: âœ… å·²å®Œæˆ
